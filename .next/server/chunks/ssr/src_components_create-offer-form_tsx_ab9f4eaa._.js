module.exports=[58534,a=>{"use strict";var b,c,d=a.i(31530),e=a.i(23991),f=a.i(78621),g=a.i(91119),h=a.i(66718),i=a.i(99570),j=a.i(11161),k=a.i(78155),l=a.i(70984),m=a.i(74076),n=a.i(6375),o=a.i(22728);a.i(32062);var p=a.i(70355),q=a.i(70465),r=a.i(63018),s=a.i(59419),t=a.i(17097);a.i(8254),(b=c||(c={}))[b.InitializeMint=0]="InitializeMint",b[b.InitializeAccount=1]="InitializeAccount",b[b.InitializeMultisig=2]="InitializeMultisig",b[b.Transfer=3]="Transfer",b[b.Approve=4]="Approve",b[b.Revoke=5]="Revoke",b[b.SetAuthority=6]="SetAuthority",b[b.MintTo=7]="MintTo",b[b.Burn=8]="Burn",b[b.CloseAccount=9]="CloseAccount",b[b.FreezeAccount=10]="FreezeAccount",b[b.ThawAccount=11]="ThawAccount",b[b.TransferChecked=12]="TransferChecked",b[b.ApproveChecked=13]="ApproveChecked",b[b.MintToChecked=14]="MintToChecked",b[b.BurnChecked=15]="BurnChecked",b[b.InitializeAccount2=16]="InitializeAccount2",b[b.SyncNative=17]="SyncNative",b[b.InitializeAccount3=18]="InitializeAccount3",b[b.InitializeMultisig2=19]="InitializeMultisig2",b[b.InitializeMint2=20]="InitializeMint2",b[b.GetAccountDataSize=21]="GetAccountDataSize",b[b.InitializeImmutableOwner=22]="InitializeImmutableOwner",b[b.AmountToUiAmount=23]="AmountToUiAmount",b[b.UiAmountToAmount=24]="UiAmountToAmount",b[b.InitializeMintCloseAuthority=25]="InitializeMintCloseAuthority",b[b.TransferFeeExtension=26]="TransferFeeExtension",b[b.ConfidentialTransferExtension=27]="ConfidentialTransferExtension",b[b.DefaultAccountStateExtension=28]="DefaultAccountStateExtension",b[b.Reallocate=29]="Reallocate",b[b.MemoTransferExtension=30]="MemoTransferExtension",b[b.CreateNativeMint=31]="CreateNativeMint",b[b.InitializeNonTransferableMint=32]="InitializeNonTransferableMint",b[b.InterestBearingMintExtension=33]="InterestBearingMintExtension",b[b.CpiGuardExtension=34]="CpiGuardExtension",b[b.InitializePermanentDelegate=35]="InitializePermanentDelegate",b[b.TransferHookExtension=36]="TransferHookExtension",b[b.MetadataPointerExtension=39]="MetadataPointerExtension",b[b.GroupPointerExtension=40]="GroupPointerExtension",b[b.GroupMemberPointerExtension=41]="GroupMemberPointerExtension",b[b.ScaledUiAmountExtension=43]="ScaledUiAmountExtension",b[b.PausableExtension=44]="PausableExtension";let u=(0,t.struct)([(0,t.u8)("instruction")]);var v=a.i(41554),w=a.i(98216),x=a.i(70734),y=a.i(43493),z=a.i(49377),A=a.i(77744);function B(){let a=(0,f.useRouter)(),{isConnected:b,isAuthenticated:t,openWalletModal:B}=(0,x.useWalletAuth)(),{createOffer:C,isLoading:D}=function(){let{publicKey:a,signTransaction:b,signAllTransactions:d}=(0,m.useWallet)(),{connection:f}=(0,n.useConnection)(),[g,h]=(0,e.useState)(!1),[i,j]=(0,e.useState)(null);return{createOffer:(0,e.useCallback)(async e=>{if(!a||!b||!d)throw Error("Wallet not connected");h(!0),j(null);try{let g;if(!await f.getAccountInfo(v.PROGRAM_ID))throw Error(`Program not found at ${v.PROGRAM_ID.toBase58()}. Make sure you're connected to the correct network (devnet/mainnet) and the program is deployed.`);let i=new q.AnchorProvider(f,{publicKey:a,signTransaction:b,signAllTransactions:d},{commitment:"confirmed"}),j=new p.Program(v.FAIR_SWAP_IDL,i),k=new r.BN(1e3*Date.now()+Math.floor(1e3*Math.random())),l=new o.PublicKey(e.tokenMintA),m=new o.PublicKey(e.tokenMintB),n=new r.BN(e.tokenAmountA),t=new r.BN(e.tokenAmountB),[x]=o.PublicKey.findProgramAddressSync([Buffer.from("offer"),a.toBuffer(),k.toArrayLike(Buffer,"le",8)],v.PROGRAM_ID),[y]=o.PublicKey.findProgramAddressSync([Buffer.from("vault"),x.toBuffer()],v.PROGRAM_ID);if(!await f.getAccountInfo(l))throw Error(`Token mint ${l.toBase58()} not found. Make sure this is a valid SPL token on the current network.`);let{address:z,instruction:A,exists:B}=await (0,w.getOrCreateAssociatedTokenAccount)(f,l,a,a),C="So11111111111111111111111111111111111111112";if(l.toBase58()===C){let b=await f.getBalance(a);g=BigInt(b)}else g=await (0,w.getTokenBalance)(f,l,a);if(g===BigInt(0))throw Error(`You have 0 tokens in your account for ${l.toBase58()}. Please add tokens to your wallet first.`);let D=BigInt(n.toString());if(g<D){let a=Number(g)/1e9,b=Number(n.toString())/1e9;throw Error(`Insufficient balance. You have ${a.toFixed(4)} tokens but need ${b.toFixed(4)}`)}let E=[];!B&&A&&E.push(A),l.toBase58()===C&&(E.push(o.SystemProgram.transfer({fromPubkey:a,toPubkey:z,lamports:Number(n.toString())})),E.push(function(a,b=s.TOKEN_PROGRAM_ID){let d=Buffer.alloc(u.span);return u.encode({instruction:c.SyncNative},d),new o.TransactionInstruction({keys:[{pubkey:a,isSigner:!1,isWritable:!0}],programId:b,data:d})}(z)));let F=j.methods.initializeOffer(k,n,m,t,e.allowAlternatives).accounts({offer:x,vault:y,sellerTokenAccount:z,tokenMintA:l,seller:a,tokenProgram:s.TOKEN_PROGRAM_ID,systemProgram:o.SystemProgram.programId,rent:o.SYSVAR_RENT_PUBKEY});E.length>0&&F.preInstructions(E);let G=await F.rpc();return await f.confirmTransaction(G,"confirmed"),h(!1),{signature:G,offerId:k.toString(),offerPda:x.toBase58()}}catch(b){console.error("Create offer error:",b);let a=b?.message||"Failed to create offer";throw a.includes("Simulation failed")?a="Transaction simulation failed. This usually means:\n1. You don't have enough SOL for transaction fees\n2. The token account doesn't exist\n3. You don't have the tokens you're trying to send\n\nOriginal error: "+a:a.includes("Transaction was not confirmed")?a="Transaction timed out. The network may be congested. Please try again.":a.includes("User rejected")&&(a="Transaction was cancelled."),j(a),h(!1),Error(a)}},[a,b,d,f]),isLoading:g,error:i}}(),[E,F]=(0,e.useState)(null),[G,H]=(0,e.useState)(null),[I,J]=(0,e.useState)(""),[K,L]=(0,e.useState)(""),[M,N]=(0,e.useState)(!1),[O,P]=(0,e.useState)({}),Q=async c=>{if(c.preventDefault(),!b)return void B();if(!t)return void z.toast.error("Please authenticate your wallet");if(!(()=>{let a={};if(E||(a.assetA="Please select an asset"),G||(a.assetB="Please select an asset"),E&&G&&E.mint===G.mint&&(a.assetB="Cannot swap the same asset"),E?.type==="token"){let b=parseFloat(I);(!I||isNaN(b)||b<=0)&&(a.amountA="Amount must be greater than 0"),E.data&&"uiAmount"in E.data&&b>parseFloat(E.data.uiAmount)&&(a.amountA=`Insufficient balance (available: ${E.data.uiAmount})`)}if(G?.type==="token"){let b=parseFloat(K);(!K||isNaN(b)||b<=0)&&(a.amountB="Amount must be greater than 0")}return P(a),0===Object.keys(a).length})())return void z.toast.error("Please fix the form errors");try{let b="nft"===E.type?"1":I,c="nft"===G.type?"1":K,d=E.decimals||0,e=G.decimals||0,f=(0,A.toTokenAmount)(b,d),g=(0,A.toTokenAmount)(c,e),h=await C({tokenMintA:E.mint,tokenAmountA:f,tokenMintB:G.mint,tokenAmountB:g,allowAlternatives:M});z.toast.success("Offer created successfully!",{description:`Transaction: ${h.signature.slice(0,8)}...`}),a.push("/marketplace")}catch(a){console.error("Failed to create offer:",a),z.toast.error("Failed to create offer",{description:a.message||"Please try again"})}};return(0,d.jsxs)(g.Card,{children:[(0,d.jsx)(g.CardHeader,{children:(0,d.jsx)(g.CardTitle,{children:"Create New Offer"})}),(0,d.jsx)(g.CardContent,{children:(0,d.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,d.jsx)(l.Coins,{className:"h-4 w-4"}),"You Offer (Asset A)"]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(y.AssetSelector,{value:E||void 0,onChange:a=>{F(a),"nft"===a.type&&J("1"),P({...O,assetA:""})},label:"Select Asset to Offer",excludeMint:G?.mint}),O.assetA&&(0,d.jsx)("p",{className:"text-xs text-red-500 mt-1",children:O.assetA}),E?.type==="token"&&(0,d.jsxs)("div",{children:[(0,d.jsx)(h.Input,{type:"number",step:"any",placeholder:"Amount (e.g., 10.5)",value:I,onChange:a=>{J(a.target.value),P({...O,amountA:""})},className:O.amountA?"border-red-500":""}),O.amountA&&(0,d.jsx)("p",{className:"text-xs text-red-500 mt-1",children:O.amountA}),E.data&&"uiAmount"in E.data&&(0,d.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Available: ",E.data.uiAmount," ",E.data.symbol]})]}),E?.type==="nft"&&(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"NFT swaps are always 1:1"})]})]}),(0,d.jsxs)("div",{className:"space-y-3",children:[(0,d.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,d.jsx)(l.Coins,{className:"h-4 w-4"}),"You Request (Asset B)"]}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(y.AssetSelector,{value:G||void 0,onChange:a=>{H(a),"nft"===a.type&&L("1"),P({...O,assetB:""})},label:"Select Asset to Request",excludeMint:E?.mint}),O.assetB&&(0,d.jsx)("p",{className:"text-xs text-red-500 mt-1",children:O.assetB}),G?.type==="token"&&(0,d.jsxs)("div",{children:[(0,d.jsx)(h.Input,{type:"number",step:"any",placeholder:"Amount (e.g., 100)",value:K,onChange:a=>{L(a.target.value),P({...O,amountB:""})},className:O.amountB?"border-red-500":""}),O.amountB&&(0,d.jsx)("p",{className:"text-xs text-red-500 mt-1",children:O.amountB})]}),G?.type==="nft"&&(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"NFT swaps are always 1:1"})]})]})]}),(0,d.jsxs)("div",{className:"flex items-start space-x-3 p-4 rounded-lg bg-muted/50",children:[(0,d.jsx)("input",{type:"checkbox",id:"alternatives",checked:M,onChange:a=>N(a.target.checked),className:"h-4 w-4 mt-0.5 rounded border-gray-300"}),(0,d.jsxs)("div",{className:"flex-1",children:[(0,d.jsx)("label",{htmlFor:"alternatives",className:"text-sm font-medium cursor-pointer",children:"Allow alternative proposals"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Buyers can propose different tokens than what you requested"})]})]}),(0,d.jsx)("div",{className:"p-4 rounded-lg bg-blue-50 dark:bg-blue-950/20 border border-blue-200 dark:border-blue-900",children:(0,d.jsxs)("p",{className:"text-sm text-blue-900 dark:text-blue-100",children:[(0,d.jsx)(k.CheckCircle,{className:"h-4 w-4 inline mr-2"}),"Your offered tokens will be locked in a secure vault on-chain until the offer is accepted or cancelled."]})})]}),(0,d.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,d.jsx)(i.Button,{variant:"outline",type:"button",onClick:()=>a.back(),disabled:D,children:"Cancel"}),(0,d.jsxs)(i.Button,{type:"submit",disabled:D||!b,children:[D&&(0,d.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),b?D?"Creating...":"Create Offer":"Connect Wallet"]})]})]})})]})}a.s(["CreateOfferForm",()=>B],58534)}];

//# sourceMappingURL=src_components_create-offer-form_tsx_ab9f4eaa._.js.map